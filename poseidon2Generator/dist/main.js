"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bb_js_1 = require("@aztec/bb.js");
async function main() {
    // Initialize Poseidon (Barretenberg WASM backend)
    console.log("[+] Initializing Poseidon...");
    const api = await bb_js_1.Barretenberg.new({ threads: 4 });
    console.log("[+] Poseidon Ready ✅");
    // Example 512D embedding (replace this with your own)
    const embedding = [-0.03266889601945877, -0.03752124682068825, 0.09994220733642578, -0.008557387627661228, 0.04177451506257057, -0.022465921938419342, 0.013347869738936424, 0.04977940395474434, -0.06660205870866776, -0.020430391654372215, 0.01842903532087803, -0.048016902059316635, 0.01108148880302906, -0.028850678354501724, 0.10515603423118591, 0.0070662954822182655, -0.06598492711782455, -0.03453608602285385, 0.009244653396308422, -0.055366601794958115, 0.05033271387219429, -0.06410010904073715, -0.013989298604428768, -0.0063637662678956985, 0.01892680674791336, 0.04686053469777107, -0.027358857914805412, -0.07461720705032349, -0.028181660920381546, 0.027179289609193802, -0.04821394011378288, 0.0044059609062969685, -0.08284035325050354, 0.00477867154404521, -0.016889015212655067, -0.09318730235099792, -0.06364698708057404, 0.01245073787868023, -0.06695970147848129, -0.0130355479195714, -0.017797674983739853, -0.06319798529148102, 0.040837887674570084, -0.04925212636590004, -0.0721084475517273, -0.03660861775279045, -0.009491224773228168, 0.06450548022985458, -0.029228882864117622, -0.039871230721473694, -0.010739644058048725, -0.013894418254494667, 0.04728621616959572, 0.013254818506538868, 0.04350113868713379, 0.06770689785480499, 0.022377943620085716, -0.03350763022899628, -0.029750507324934006, -0.060876861214637756, -0.029651492834091187, 0.006823225412517786, 0.03079860657453537, -0.027495408430695534, -0.020504852756857872, 0.034394729882478714, -0.0337860994040966, -0.03142628073692322, 0.05341533198952675, -0.0009472326491959393, 0.009617559611797333, 0.06887538731098175, -0.006235696375370026, -0.0380440279841423, 0.003952558618038893, 0.01421304326504469, 0.061523664742708206, -0.04254141077399254, 0.06493121385574341, -0.056334055960178375, -0.06354247778654099, 0.02856382541358471, 0.017355678603053093, 0.011550127528607845, -0.029359525069594383, 0.02615228109061718, -0.10739114880561829, 0.013661550357937813, 0.07842819392681122, 0.042382918298244476, -0.00018536660354584455, -0.012722323648631573, 0.004314966965466738, -0.06062426418066025, 0.0558234341442585, -0.020414263010025024, 0.03312136232852936, -0.04632243886590004, 0.02162528783082962, 0.019115619361400604, -0.023347146809101105, 0.0802786573767662, 0.003832219634205103, -0.046025436371564865, -0.00037887637154199183, -0.04532903805375099, -0.041182782500982285, 0.007647455669939518, -0.00038325812784023583, 0.039294224232435226, 0.00045898911776021123, 0.024052241817116737, -0.0492122583091259, 0.07605278491973877, -0.042143795639276505, -0.02000102587044239, 0.010320628061890602, 0.029505619779229164, -0.006133046001195908, 0.012780321761965752, 0.017289966344833374, 0.0062307436019182205, -0.10633998364210129, 0.008587583899497986, -0.015919154509902, 0.024401923641562462, -0.1306687891483307, 0.004677759949117899, 0.06799786537885666, 0.05823434144258499, -0.05374620482325554, -0.031631894409656525, 0.021936804056167603, -0.06400485336780548, -0.05587118864059448, 0.0250457264482975, -0.0821806862950325, 0.006312552373856306, 0.06738761067390442, -0.04699673876166344, 0.027487311512231827, -0.040721599012613297, -0.014135314151644707, 0.06139323115348816, -0.03791264444589615, 0.00859143491834402, 0.0151815889403224, -0.03190196678042412, -0.02958020754158497, 0.021326059475541115, -0.06731416285037994, 0.017013786360621452, 0.009128154255449772, -0.004700636491179466, -0.05051487684249878, 0.044658634811639786, -0.02570519596338272, 0.0038409957196563482, -0.004947694484144449, 0.04211270064115524, -0.02930375561118126, 0.04044230654835701, 0.03549604117870331, 0.004350664094090462, 0.0346883200109005, -0.01720915548503399, 0.03861527889966965, -0.07648158073425293, -0.049793943762779236, 0.015248258598148823, 0.11009630560874939, 0.04189303517341614, 0.00400838628411293, 0.03527466207742691, -0.0024374390486627817, -0.02703421376645565, -0.07433882355690002, 0.04984597489237785, 0.0644591748714447, -0.011532596312463284, 0.003537587821483612, -0.054364461451768875, -0.048753391951322556, 0.0432940274477005, -0.06825387477874756, 0.08192495256662369, -0.02328640967607498, 0.06632516533136368, -0.04604041576385498, 0.06465847045183182, 0.009309186600148678, -0.049916528165340424, -0.011980411596596241, -0.012449435889720917, 0.041773512959480286, 0.0246682520955801, 0.0010029046097770333, -0.050752922892570496, -0.01000893209129572, 0.02218308113515377, -0.03992199897766113, -0.06779883056879044, 0.016258561983704567, 0.013089697808027267, 0.03666292503476143, 0.055915702134370804, -0.06823410838842392, -0.027499495074152946, -0.08072178810834885, 0.04405435174703598, 0.05240066349506378, -0.08672168105840683, -0.006812273990362883, -0.07962857931852341, 0.020105091854929924, -0.011839768849313259, -0.028395289555191994, 0.007565897889435291, 0.04111001268029213, 0.010383516550064087, -0.029376011341810226, -0.07159897685050964, 0.056130874902009964, -0.015696320682764053, 0.02294292487204075, 0.05822601169347763, -0.028273889794945717, -5.0991893658647314e-05, -0.01547640934586525, 0.042987924069166183, 0.012903842143714428, -0.019277969375252724, 0.09053577482700348, 0.01680079661309719, 0.010566246695816517, -0.03850000351667404, 0.10025220364332199, -0.014097098261117935, -0.005181964486837387, 0.0796365737915039, -0.004593731835484505, 0.040111951529979706, 0.004807270597666502, 0.07429247349500656, 0.019183972850441933, -0.06740055978298187, 0.008576842956244946, 0.007258064113557339, 0.08141020685434341, 0.0031069491524249315, 0.031689755618572235, -0.03965679928660393, 0.026445088908076286, -0.007934154942631721, 0.06432279199361801, 0.0413808710873127, -0.015965256839990616, 0.06605321168899536, 0.018261147662997246, 0.054881781339645386, 0.0021818429231643677, -0.019756203517317772, 0.03668779507279396, -0.06636942923069, -0.07316596060991287, -0.00964912585914135, 0.05184377729892731, 0.005460030864924192, 0.033593300729990005, 0.026980187743902206, -0.02288748510181904, 0.046675581485033035, -0.005938936024904251, 0.04773664474487305, -0.01390398945659399, 0.05888079106807709, -0.03833082690834999, 0.05612755939364433, -0.054190754890441895, 0.014715885743498802, -0.07216513901948929, 0.014563361182808876, 0.054671790450811386, 0.04222133755683899, 0.0018444218439981341, -0.031058451160788536, 0.04491911455988884, -0.02662523277103901, 0.00619032047688961, -0.02634347602725029, -0.10969316959381104, -0.039402928203344345, 0.042712677270174026, 0.020435404032468796, -0.0733528733253479, 0.05940626561641693, 0.048221223056316376, -0.029468806460499763, -0.05549069494009018, -0.05673035606741905, -0.003452986478805542, -0.04380498453974724, -0.09632653743028641, -0.03830142319202423, -0.0391194187104702, 0.023190585896372795, -0.00017544665024615824, -0.022493915632367134, -0.10522835701704025, 0.04370848834514618, 0.014834384433925152, -0.07584237307310104, 1.39226549435989e-05, 0.03623940795660019, -0.08727500587701797, -0.006649824324995279, 0.03134077787399292, 0.03795771300792694, -0.015933504328131676, 0.04145335406064987, 0.0549284964799881, 0.059536777436733246, -0.003913857042789459, -0.0044458177872002125, -0.01087935920804739, 0.006502365227788687, -0.006137858610600233, -0.03870140761137009, -0.06381914019584656, -0.016446862369775772, -0.011864821426570415, -0.09832079708576202, -0.025727901607751846, 0.006836255546659231, -0.041597407311201096, 0.03261468559503555, -0.03380229324102402, 0.01811445690691471, -0.006923808716237545, 0.013541282154619694, -0.021177390590310097, -0.037676215171813965, -0.0791327953338623, 0.004027332179248333, -0.04330098628997803, -0.0990920141339302, 0.057574644684791565, 0.024374909698963165, 0.03756736218929291, 0.04382121190428734, 0.02869986928999424, -0.013743864372372627, -0.09892573952674866, 0.01723710633814335, -0.006993582937866449, -0.06124039739370346, -0.06912463158369064, -0.00954711064696312, 0.033948350697755814, -0.00805389229208231, -0.03191859647631645, 0.01349935494363308, -0.03191768005490303, -0.017626486718654633, -0.0915294885635376, 0.049836475402116776, 0.0014859711518511176, 0.018701739609241486, -0.013145245611667633, 0.023766785860061646, 0.015529405325651169, -0.03202506899833679, 0.0001272073423024267, -0.024840496480464935, -0.055193353444337845, 0.026236170902848244, -0.07997811585664749, 0.029532426968216896, 0.008409837260842323, -0.014911464415490627, -0.028873343020677567, 0.016888881102204323, 0.041397977620363235, 0.05475645884871483, 0.009356461465358734, 0.07181058824062347, 0.002068563364446163, -0.01746191829442978, 0.010230126790702343, -0.03964465111494064, -0.04593312367796898, 0.030898485332727432, -0.015572835691273212, 0.0045064655132591724, -0.04066696763038635, -0.06784497201442719, -0.01963379606604576, 0.0037701802793890238, -0.006422980222851038, -0.0067319851368665695, 0.04948384687304497, -0.06360255926847458, 0.03140907362103462, -0.00041507947025820613, -0.06947537511587143, 0.03598317131400108, 0.03900563344359398, -0.0016950827557593584, 0.06454189121723175, -0.07557476311922073, 0.0431412011384964, -0.02330051176249981, -0.03302355855703354, -0.0249541774392128, 0.04854822903871536, -0.0824926421046257, -0.05107330530881882, -0.02102539874613285, 0.031049540266394615, -0.03807290270924568, 0.018873119726777077, -0.03130435571074486, 0.06161049008369446, 0.05983201786875725, 0.009018640965223312, -0.03149177134037018, -0.03536825627088547, 0.057122793048620224, -0.01838552951812744, -0.07334581017494202, -0.09915686398744583, 0.020321089774370193, 0.029933324083685875, 0.06914276629686356, -0.007216931786388159, -0.021973200142383575, 0.03152801841497421, -0.014904147014021873, 0.025462713092565536, 0.011785351671278477, -0.002062838291749358, 0.02210346609354019, -0.014219985343515873, 0.046634528785943985, -0.006882247049361467, 0.09394552558660507, -0.02655795030295849, -0.012798719108104706, -0.013216182589530945, -0.014794711023569107, -0.02400946244597435, -0.0327998511493206, -0.018092544749379158, -0.01839638128876686, -0.007651124615222216, 0.006067855749279261, 0.006513978820294142, -0.04084443300962448, 0.03882633522152901, -0.06649592518806458, -0.041520409286022186, 0.01940111629664898, 0.05224233865737915, -0.0007832431001588702, 0.002300957450643182, -0.0020935607608407736, -0.004735755734145641, 0.07554060965776443, -0.06229608878493309, -0.03666200116276741, -0.007132506929337978, 0.15997281670570374, -0.010962851345539093, 0.016740713268518448, -0.05721418932080269, 0.03118067979812622, -0.017915531992912292, 0.07489708811044693, 0.05915645509958267, -0.04477046802639961, -0.059100840240716934, 0.027636125683784485, 0.005907515995204449, 0.005499385762959719, -0.0403045229613781, -0.024078309535980225, -0.1194438561797142, 0.008021675981581211, 0.06168780475854874, -0.06210845336318016, -0.04735098034143448, -0.011119126342236996, -0.04068012908101082, 0.01586645096540451, 0.03263946622610092, -0.04957079887390137, -0.07969412952661514, -0.00953817181289196, 0.007024405058473349, -0.02723102644085884, -0.0040378873236477375, -0.05225279554724693, 0.0729333832859993, -0.06113597750663757, -0.06992322206497192, -0.04240645468235016, -0.01948062889277935, 0.016368020325899124, 0.0038556503131985664, -0.045749109238386154, -0.06705041974782944, 0.011176039464771748];
    console.log(`[+] Received embedding of length: ${embedding.length}`);
    // Finite field prime for BN254 (Poseidon2 domain)
    const FIELD_PRIME = BigInt("21888242871839275222246405745257275088548364400416034343698204186575808495617");
    // Scale and shift constants
    const SCALE = 1e6; // 6 decimal places of precision
    const SHIFT = 1e6; // shift +1 to remove negatives safely
    // Convert float embedding → BigInt field elements
    const embeddingBigInts = embedding.map((x) => {
        const scaled = Math.floor((x + 1) * SCALE); // shift + scale
        return BigInt(scaled);
    });
    // Ensure values fit inside the field
    const fieldElements = embeddingBigInts.map((x) => new bb_js_1.Fr(x % FIELD_PRIME));
    // Compute Poseidon2 hash
    const hashFr = await api.poseidon2Hash(fieldElements);
    const hashBigInt = BigInt(hashFr.toString());
    console.log("===============================================");
    console.log("Poseidon2 Hash (Fr format):");
    console.log(hashBigInt.toString());
    console.log("===============================================");
}
main().catch((err) => console.error("❌ Error:", err));
